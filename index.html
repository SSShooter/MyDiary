<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Home</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<!-- 新 Bootstrap 核心 CSS 文件 -->
	<link rel="stylesheet" href="bootstrap/bootstrap.min.css">
	<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
	<script src="lib/jquery.min.js"></script>
	<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
	<script src="bootstrap/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="icon/iconfont.css">
	<!-- 自定义bs -->
	<link rel="stylesheet" type="text/css" href="css/custombs.css">
	<link rel="stylesheet" type="text/css" href="css/animate.min.css">
	<style type="text/css">
		header{
			/*padding for导航栏*/
			padding-top: 22px;
			height: 88px;
			position: fixed;
			width: 100vw;
			background-color: #5A95BA;
			color: #fff;
		}
		header img{
			float: left;
			height: 100%;
			padding: 10px 10px; 
		}
		header .name{
			float: left;
			padding: 10px 10px; 
		}
		header .name span{
			display: block;
		}
		header .name .nickname{
			font-weight: bold;
			font-size: 25px;
			line-height: 25px;
		}
		#main{
			min-height: 100vh;
			box-sizing: border-box;
			padding-top:89px; 
			padding-bottom: 44px;
		}
		#main .item{
			border-bottom: 1px #ccc solid;
			padding: 10px 30px 10px 0;
			margin-left: 30px;
			line-height: 50px;
			font-size: 18px; 
			color: rgb(92,115,136);
		}
		.item > .iconfont{
			font-size: 18px;
			margin-right: 10px;
		}
		.item .total, .total > .iconfont{
			font-size: 10px;
		}
		footer{
			position: fixed;
			width: 100vw;
			height: 44px;
			background-color: #fff;
			border-top: 1px #CACACA solid;
			bottom: 0;
		}
		footer input{
			border: none;
			border-radius: 10px;
			background-color: #5A95BA;
			color: #fff;
			width: 70%;
			vertical-align:middle;
			position: relative;
			margin-left: 10px;
			margin-top: 6px;
			line-height: 28px;
			padding-left: 28px;
		}
		footer .iconfont{
			vertical-align: middle; 
			line-height: 44px;
			font-size: 25px;
			color: #5A95BA;
		}
		footer .icon-search{
			position: absolute;
			color: #fff;
			left: 10px;
		}
		footer .icon-setting{
			position: absolute;
			right: 10px;
		}

		#search-result{
			display: none;
			background-color: rgba(0,0,0,.5);
			position: absolute;
			height: calc(100vh - 44px);
			width: 100vw;
			top: 0;left: 0;
			padding-top: 20px;
			overflow: scroll;
		}
		#search-result .item{
			height: 80px;
			background-color: #fff;
			border-radius: 6px;
			margin-bottom: 10px;
			color: #5A95BA;
		}
		.date-and-week{
			padding-top: 10px;
			height: 60px;
			width: 60px;
			text-align: center;
		}
		.date-and-week .date{
			font-size: 40px;
			line-height: 40px;
			margin-bottom: 0;
		}
		.content{
			padding-top: 14px;
		}
		.content p{
			margin-bottom: 0;
		}
		.content .create_time{
			font-size: 10px;
		}
		.content .description{
			font-size: 10px;
		}
		.state{
			padding-right: 10px;
			padding-top: 14px;
		}
		.state i{
			margin: 0 2px;
		}
		.state p{
			text-align: right;
			font-size: 20px;
		}
		#setting-div{
			height: 60px;
			width: 100vw;
			background-color: #5A95BA;
			position: fixed;
			bottom: 0;
			display: none;
			color: #fff;
			line-height: 60px;
		}
		#setting-div .iconfont{
			text-align: center;
			font-size: 30px;
			width: 32%;
			display: inline-block;
		}
		#setting-mask{
			position: absolute;
			top: 0;
			left: 0;
			height: 100%;
			width: 100vw;
			background-color: rgba(0,0,0,.5);
			display: none;
		}
		/*table居中法*/
		.table {
			 display: table;
			 height:100%;
			 pointer-events:none;/* This makes sure that we can still click outside of the modal to close it */
		}
		.table-cell {
			display: table-cell;
			vertical-align: middle;
			pointer-events:none;
		}
		.modal-content{
			pointer-events: all;
		}
		input[type="radio"]{
		  display: none;
		}
		.checkbox label{
			opacity: .5;
		}
		.checkbox label.checked{
			opacity: 1;
		}
		strong{
			display: inline-block;
			margin-bottom: 5px;
		}
	</style> 
</head>
<body>

<div class="pop-up" id="newfolder">
	<div class="pop-up-box clearfix">
		<div class="checkbox">
			<strong>folder type</strong>
			<label name="diary" class="checked" for="diary"><i class="iconfont icon-book"></i>diary<input type="radio" id="diary" checked="checked" value="diary"></label>
			<label name="list" for="list"><i class="iconfont icon-alert"></i>list<input type="radio" id="list" value="list"></label>
			<label name="address" for="address"><i class="iconfont icon-phone"></i>address book<input type="radio" id="address" value="address"></label>
		</div>
		<div class="form-group">
			<strong>folder name</strong>
			<input type="text" name="folder_name" class="form-control">
		</div>
		<button type="submit" class="btn btn-default pull-right" id="submitNewFolder">Submit</button>
	</div>
</div>

	<div id="setting-mask"></div>
	<div class="app">
		<header>
			<img src="img/avatar.png" alt="avatar" class="img-circle">
			<div class="name">
				<span class="nickname">立花　瀧</span>
				<span class="realname">たちばな　たき</span>
			</div>
		</header>
		<div id="main"></div>
		<div id="search-result" class="container">
			
		</div>
		<footer>
			<input type="text" name="search" id="search" />
			<i class="iconfont icon-search"></i>
			<i class="iconfont icon-setting" id="setting"></i>
		</footer>
	</div>
	<div id="setting-div">
		<i class="iconfont icon-tianjia" id="new" data-toggle="modal" data-poptarget="newfolder"></i>
		<i class="iconfont icon-zhuti" id="theme" onclick="changeTheme()"></i>
		<i class="iconfont icon-about" id="about" onClick="location='about.html'"></i>
	</div>
	<script src="js/common.js"></script>
	<script src="lib/velocity.min.js"></script>
	<script type="text/javascript" src="js/indexeddb.js"></script>
	<script type="text/javascript">
		var data = [
			{type:"phone",count:0 ,icon:"phone",name:"緊急時以外かけちゃダメ"},
			{type:"diary",count:0 ,icon:"book",name:"Diary"},
			{type:"diary",count:0 ,icon:"book",name:"みつはのにっき"},
			{type:"list" ,count:0,icon:"alert",name:"ゼッタイ禁止"},
			{type:"list" ,count:0,icon:"alert",name:"行きたいおみせメモ"}
		];
		if(localStorage.theme === 'mitsuha'){
			$('head').append('<link rel="stylesheet" type="text/css" href="css/mitsuha.home.css"><link rel="stylesheet" type="text/css" href="css/mitsuha.bs.css">');
		}
		$('#new').popUpPop('newfolder');
		getDataAll("menu", process);
		function process(rowdata){
	    	var data = rowdata.data;
	    	var monthDivision;
	    	console.log(data);
	    	for(var i = 0;i<data.length;i++){
	    		console.log(data[i].type + ' ' + data[i].folder_id);
	    		var item = '<div class="item" id="'+ data[i].type+'_'+data[i].folder_id +'"><i class="iconfont icon-'+ data[i].icon +'"></i><span>'+ data[i].name +'</span><span class="total pull-right">'+ data[i].count +'<i class="iconfont icon-xiayige"></i></span></div>';
	    		$("#main").append(item);		    		
	    	}
	    }
	    $('#main').on('click','.item',function(){
	    	var type = $(this).attr('id');
	    	var folder_name = $(this).children('span').first().html();
	    	type = type.split("_");
	    	if (type[0]==='diary') {
	    		location = 'entries.html';
	    	}else if(type[0]==='list'){
	    		location = 'list.html';
	    	}else{
	    		location = 'address.html';
	    	}
	    	localStorage.setItem('folder', type[1]);
	    	localStorage.setItem('folder_name', folder_name);
	    });
	    $('#search').on('input',function(e){ 
	    	var input_content = $(this).val();
		    if(input_content){
		    	$('#search-result').fadeIn();
		    	var items = '';
				searchString($(this).val(),function(data){
					for(var i = 0;i<data.length;i++){
			    		var item = '<div id="'+data[i].id+'" data-toggle="modal" data-target="#myModal" class="item"><div class="date-and-week pull-left"><p class="date">'+data[i].date+'</p><p class="week">'+data[i].day+'</p></div><div class="content pull-left"><p class="create_time">'+data[i].time+'</p><p class="title">'+data[i].title+'</p><p class="description">'+data[i].description+'</p></div><div class="state pull-right"><i class="iconfont icon-qing"></i><i class="iconfont icon-smile-copy"></i><i class="iconfont icon-biaoqian"></i></div></div>';
			    		items+=item;
			    	}
			    	$("#search-result").html(items);
				});
		    }else{
		    	$('#search-result').fadeOut();
		    }
		});  
		$('#setting').click(function(){
			$('#setting-mask').fadeIn();
			$('#setting-div').fadeIn();
		});
		$('#setting-mask').on('touchstart',function(e){
		    e.preventDefault();//禁止滚动
		});
		$('#setting-mask').on('touchend',function(e){
		    $('#setting-mask').fadeOut();
			$('#setting-div').fadeOut();
		});

		function changeTheme() {
			if (localStorage.theme === 'mitsuha') {
				localStorage.setItem('theme','taki');
			}else{
				localStorage.setItem('theme','mitsuha');
			}
			location.reload();
		}

		$(function() {
		  $('label').click(function(){
		    var radioId = $(this).attr('name');
		    $('label').removeAttr('class') && $(this).attr('class', 'checked');
		    $('input[type="radio"]').removeAttr('checked') && $('#' + radioId).attr('checked', 'checked');
		  });
		});

		$('#submitNewFolder').click(function() {
			var type = $('input[type="radio"]:checked').attr('value');
			var name = $('input[name="folder_name"]').val();
			var icon;
			if (type==='diary') {
				icon = 'book';
			}else if (type==='list'){
				icon = 'alert';
			}else{
				icon = 'phone';
			}
			if(name){
				var newdata = {type:type, count:0 ,icon:icon, name:name};
				console.log(newdata);
				addData('menu', newdata, function(){
					alert('添加成功');
					location.reload();
				});
			}else{
				alert('请输入文件夹名');
			}
		});
	</script>
</body>
</html>